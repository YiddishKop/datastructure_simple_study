<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-08-09 四 23:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>第十八课 Encapsulation</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yiddishkop" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/home/yiddi/git_repos/YIDDI_org_export_theme/theme/org-nav-theme_cache.css" >
<script src="https://hypothes.is/embed.js" async></script>
<script type="application/json" class="js-hypothesis-config">
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">第十八课 Encapsulation</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge6595e2">1. A Cautionary Tale</a></li>
<li><a href="#org980d9e5">2. A Remedy:  Encapsulation</a></li>
<li><a href="#orge726097">3. Enforcing Encapsulation</a></li>
<li><a href="#org1c1d847">4. Modules and Interfaces in Project 2</a></li>
</ul>
</div>
</div>
<p>
A <span class="underline">module</span> is a set of methods that work together as a whole to perform some
task or set of related tasks.  A module is <span class="underline">encapsulated</span> if its implementation
is completely hidden, and it can be accessed only through a documented
interface.
</p>

<p>
As you know, an abstract data type (ADT) is an encapsulated data structure.
Not all encapsulated modules are ADTs, though.  Algorithms (like list sorters)
and applications (like network routing software) can also be encapsulated, even
if they are distinct from the data structures they use.
</p>

<p>
So far, I've discussed encapsulation as a way of preventing "evil tamperers"
from corrupting your data structures.  Who are these evil tamperers?
Sometimes, they're your coworkers, or other programmers who will work on a
project long after you're gone.  Often the evil tamperer is you.
</p>

<div id="orge6595e2" class="outline-2">
<h2 id="orge6595e2"><span class="section-number-2">1</span> A Cautionary Tale</h2>
<div class="outline-text-2" id="text-1">
<p>
Doug Whole, a programmer at a Silicon Valley startup, implements a singly-
linked list much like the one you used in Homework 3, but all its fields are
public.  Doug also writes application code that uses linked lists.  One day,
Doug needs to write code that splices the second node out of a list.  It would
only take one line, and he doesn't foresee ever needing to use the same
operation anywhere else.  Being lazy, Doug doesn't feel like adding a new
method to the List class.  Instead, he just does the work directly.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ListMangler</span> {
  [lotsa code]

  <span style="color: #2aa1ae; background-color: #292e34;">/* </span><span style="color: #2aa1ae; background-color: #292e34;">Gosh, I am sooooooooooooooooooo tired. */</span>
  list.head.next = list.head.next.next;

  [lotsa more code]
}
</pre>
</div>

<p>
Two years later, another programmer, Jeannie Yess, decides to improve the speed
of their list data structure.  After careful thought, she decides to reprogram
the List class so that it uses doubly-linked lists internally.  A "previous"
field is added to ListNode, and the List methods are rewritten.
</p>

<p>
Jeannie tests her new List implementation extensively, and can find no bugs.
But when she replaces Doug's List class with her own, the company's landmark
ListMangler application repeatedly produces the wrong results.  After two long
days of debugging, Jeannie discovers the culprit:  Doug's single line of code.
</p>

<p>
This kind of bug is one of the most difficult to find and fix.  It's also very
common in commercial software systems, and it can have far-reaching effects.
</p>

<p>
You see, Doug's line of code is not the only one that reads or modifies the
list data structure directly.  Jeannie still has to debug 100,000 lines of
Doug's code in other failing applications, as well as 500,000 lines more
written by other programmers who also directly manipulated ListNodes.  The List
improvement project is abandoned.
</p>
</div>
</div>
<div id="org980d9e5" class="outline-2">
<h2 id="org980d9e5"><span class="section-number-2">2</span> A Remedy:  Encapsulation</h2>
<div class="outline-text-2" id="text-2">
<pre class="example">
                                                             Applications
You "encapsulate" a module by defining an interface
through which the outside world can use, inspect, or            ^ | ^ |
manipulate it.  Recall that the interface is the set of         | | | |
prototypes and behaviors of the methods (and sometimes  -------Interface-------
fields) that access the module or data structure.       |       | | | |       |
                                                        |       | v | v       |
Think of a module or an ADT as a closed box.            |                     |
Data can ONLY go in and out through the interface.      |      Module or      |
Other attempts to access the internals of the module    | Abstract Data Type  |
or ADT are outlawed.                                    |                     |
                                                        -----------------------

</pre>

<p>
<b>Why encapsulation is your friend:</b>
</p>

<ol class="org-ol">
<li>The implementation is independent of the functionality. A programmer who
has the documentation of the interface can implement a new version of the
module or ADT independently. A new, better implementation can replace an
old one.</li>
<li>Encapsulation prevents Doug from writing applications that corrupt a
module's internal data. In real-world programming, encapsulation reduces
debugging time. A lot.</li>
<li>ADTs can guarantee that their invariants are preserved.</li>
<li>Teamwork. Once you've rigorously defined interfaces between modules, each
programmer can independently implement a module without having access to
the other modules. A large, complex programming project can be broken up
into dozens of pieces.</li>
<li>Documentation and maintainability. By defining an unambiguous interface,
you make it easier for other programmers to fix bugs that arise years after
you've left the company. Many bugs are a result of unforeseen interactions
between modules. If there's a clear specification of each interface and
each module's behavior, bugs are easier to trace.</li>
<li>When your Project 2 doesn't work, it will be easier to figure out which
teammate to blame.</li>
</ol>

<p>
An interface is a CONTRACT between module writers, specifying exactly how they
will communicate.
</p>
</div>
</div>

<div id="orge726097" class="outline-2">
<h2 id="orge726097"><span class="section-number-2">3</span> Enforcing Encapsulation</h2>
<div class="outline-text-2" id="text-3">
<p>
Many languages offer only one construct for enforcing the encapsulation of ADTs:
<b>self-discipline.</b>
</p>

<p>
As we've seen, Java offers facilities that fortify your self-discipline,
especially Java packages and the "private", package, and "protected" modifiers
for field and method declarations.
</p>

<p>
Java's facilities aren't always enough, though. There are circumstances in which
you'll want to have multiple modules in the same package. For instance, in
Project 2 it would be reasonable to put all your modules in the "player"
package. If you do that, you'll have to fall back on self-discipline. This means
defining your modules and interfaces before you start programming, and resisting
the temptation to let one module snoop through or change another module's data
structures.
</p>

<p>
One way to find this self-discipline is, wherever one module uses another, to
have a different team member work on each module.  If neither team member
reveals their code to the other, it's much harder to yield to temptation.
</p>
</div>
</div>
<div id="org1c1d847" class="outline-2">
<h2 id="org1c1d847"><span class="section-number-2">4</span> Modules and Interfaces in Project 2</h2>
<div class="outline-text-2" id="text-4">
<p>
In Project 2, you are required to divide the programming task into modules,
define interfaces between them, and document these interfaces in your GRADER
file, before you start programming.  This will allow you to work as a team.
</p>
<pre class="example">

The game-playing program you will write for              -----------------
Project 2 can easily be broken down into a               | MachinePlayer |
number of modules.  Four likely examples are             -----------------
illustrated at right.  Your MachinePlayer, its     modules       |
game tree search (with alpha-beta pruning), the         --------------------
board evaluation function, and the module that          | game tree search |
identifies winning networks can all be                  --------------------
implemented completely independently, even                  |             |
though they will ultimately work together.       -----------------------  |
                                                 | evaluation function |  |
You should probably break your MachinePlayer     -----------------------  |
down into a few more modules than this (the                      |        |
project README gives a few more suggestions), but        ----------------------
don't try to break it up too much.  You will             | network identifier |
reach a point where it is no longer possible to          ----------------------
subdivide any module into pieces that are
independent and communicate through _simple_ interfaces.
</pre>

<p>
You might still be confused:  what exactly <span class="underline">is</span> a module?  It's a collection of
methods that provide some functionality through a single (hopefully elegant)
interface.  The main difference between a module and a class is this:
</p>

<ul class="org-ul">
<li>A <span class="underline">module</span> is organized around the <span class="underline">functionality</span> it provides.</li>
<li>A <span class="underline">class</span> is organized around a <span class="underline">data_storage_unit</span>.  (Remember that an
object is a repository of data.)</li>
</ul>

<p>
The concept of modules is a bit abstract for several reasons.
</p>

<ul class="org-ul">
<li>A module can be made up of several classes, or a class could be made up of
several modules.  Module boundaries and class boundaries can be independent
of each other.
<ul class="org-ul">
<li>Why would a module have several classes?  Because it might implement
a data structure made up of several classes of objects.  For example,
a List ADT has a list object and node objects.  A Graph ADT has a graph
object, vertices, and edges.</li>
<li>Why would a class have several modules?  Because a single class of
object might support many independent operations.  The game tree search
and the evaluation function above both operate on a Network game board,
but they are independent enough of each other that you could change
the implementation of one without changing the other.  (Of course, if
you change the way a game board is represented, you'll have to change
both implementations.)</li>
</ul></li>
<li>A module may include many methods, or as few as one.  (But not every method
needs its own module!)</li>
<li>A package may contain one module or many.</li>
</ul>

<p>
For Project 2, you should document your modules and interfaces as follows.
</p>

<ul class="org-ul">
<li>List the modules.</li>
<li>For each module, specify its interface.
<ul class="org-ul">
<li>Recall that an interface includes the prototype(s) for the methods by
which the module can be called.  This list does not necessarily include
all the methods in the module!  It only includes the methods that are
available for <span class="underline">external</span> callers (outside the module).</li>
<li>An interface also includes, for each prototype, a comment that
describes precisely the module's behavior from an <span class="underline">external</span> observer's
point of view.  Your description does not need to state how the module
is implemented, though.  For instance, a module that does game tree
search should say that it returns a good, legal move, but it does not
need to say that it does alpha-beta pruning.  (It's not forbidden to
say this, though.)  Likewise, you should state that the "network
identifier" determines whether a game board contains a winning network
for a given player, but the interface does not need to specify what
algorithm is used to look for winning networks.  (A description of the
algorithm should be included in the comments <span class="underline">in</span> the implementation,
but it is not part of the <span class="underline">interface</span>.)</li>
<li>The behavior comment should also describe, for each prototype, every
parameter and the return value (if any), and how they are interpreted.
Here you are making a <span class="underline">contract</span> that your module will speak a certain
language when it communicates with external callers.</li>
</ul></li>
</ul>

<p>
Here's a short example of an interface you might put in your GRADER file.
(You are not required to implement it this way; this is just an example.
Other modules will probably require longer behavioral descriptions.)
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;"> *  hasValidNetwork() determines whether "this" GameBoard has a valid network</span>
<span style="color: #9f8766;"> *  for player "side".  (Does not check whether the opponent has a network.)</span>
<span style="color: #9f8766;"> *  A full description of what constitutes a valid network appears in the</span>
<span style="color: #9f8766;"> *  project "readme" file.</span>
<span style="color: #9f8766;"> *</span>
<span style="color: #9f8766;"> *  Unusual conditions:</span>
<span style="color: #9f8766;"> *    If side is neither MachinePlayer.COMPUTER nor MachinePlayer.OPPONENT,</span>
<span style="color: #9f8766;"> *          returns false.</span>
<span style="color: #9f8766;"> *    If GameBoard squares contain illegal values, the behavior of this</span>
<span style="color: #9f8766;"> *          method is undefined (i.e., don't expect any reasonable behavior).</span>
<span style="color: #9f8766;"> *</span>
<span style="color: #9f8766;"> *  </span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> side is MachinePlayer.COMPUTER or MachinePlayer.OPPONENT</span>
<span style="color: #9f8766;"> *  </span><span style="color: #a45bad;">@return</span><span style="color: #9f8766;"> true if player "side" has a winning network in "this" GameBoard;</span>
<span style="color: #9f8766;"> *          false otherwise.</span>
<span style="color: #9f8766;"> **/</span>
</pre>
</div>
<p>
protected boolean hasValidNetwork(int side)
</p>

<p>
Your description of how a module behaves should be complete and unambiguous,
and should take into account unusual and erroneous inputs and circumstances.
(It's sometimes okay if your module doesn't handle an erroneous input well, but
you should document that.)  When you and your partners are writing the
interfaces for each module, think carefully about whether you believe these
interfaces will really allow all the modules to do everything they need to do.
</p>

<p>
When you design your interfaces, they should appear (prototypes and behavioral
descriptions both) in both the GRADER file and in the code itself.  Once
you've finished, decide which team members will implement which modules, and
start programming.
</p>

<p>
You may find your team returning to modify the interfaces after a first attempt
at programming, but that's okay.  Just be sure to change the documentation (in
both GRADER and the code comments) to reflect your new design decisions.
</p>

<p>
I recommend you write a draft of your interfaces this week so you'll have lots
of time to program. The interfaces in the GRADER file are worth 10% of your
project score. You will need to show them to your TA next week in Lab 8.
</p>
</div>
</div>
</div>
</body>
</html>
